#!/bin/bash
# CAUTION: Do not edit this file.
# this script is generated by consul-template

LOGGER=$(basename -s .sh $0)
. /usr/lib/chip-in/functions.sh

function load () {
  message "remove old metadatas /etc/shibboleth/metadata/*.xml"
  /bin/rm -f /etc/shibboleth/metadata/*.xml
{{- range ls "metadatas" }}{{ $metadata := .Value | parseJSON }}
  {{- if $metadata.metadata }}
  message "Download metadata for {{ .Key }} into /etc/shibboleth/metadata/{{ .Key }}.xml"
  base64 -d  << __EOF | upload /etc/shibboleth/metadata/{{ .Key }}.xml shibboleth
{{ base64Encode $metadata.metadata }}
__EOF
  {{- end }}
{{- end }}
  reloadShibboleth
}

load
